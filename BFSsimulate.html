<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>BFS(Breadth-first search)</title>
		<style>
		
		canvas{
			border: solid 1px green;
		}
		
	</style>
		
	</head>
	
	<body>
		
		<table>
			<tr>
				<td>
					
					<form name = "BFSForm" id="BFSForm" >
						<table>
						<tr>
							<td><p>1.設定模式:</p></td>  <td><input type="radio" name="modeChoice1" value="模擬模式" onClick = "modeChoice();">模擬模式</td>  <td><input type="radio" name="modeChoice1" value="測驗模式" onClick = "modeChoice();">測驗模式   </td>
							<td><input type = "button"  value = "清除" onClick = "modeClear();"></td><td><p id="mode"></p></td>

						</tr>
						<tr>
							<td><p>2.設定圖形模式</p></td>  <td><input type="radio" name="graph1" value="undirected graph" onClick = "graphChoice();">undirected graph</td>  <td><input type="radio" name="graph1" value="directed graph" onClick = "graphChoice();">directed graph   </td>
							<td><input type = "button"  value = "清除" onClick = "graphClear();"></td><td><p id="graph"></p></td>
						</tr>
						</table>

						<table>
							<tr>
								<td>3.輸入資料：</td>  
							</tr>
						</table>
						<table>
							<tr>
								<td></td>
								<td><p>0</p></td>
								<td><p>1</p></td>
								<td><p>2</p></td>
								<td><p>3</p></td>
								<td><p>4</p></td>
								<td rowspan = "7"><canvas id = "myGraph" width = 280 height = 280>Your browser does not support</canvas></td>

								<td><p>5.各圓的關係</p></td>
								
							</tr>
							<tr>
								<td><p>0</p></td>
								<td><input type=text value="0" id=0 size="5" readonly="readonly"></td>
								<td><input type=text value="" id=1 size="5"></td>
								<td><input type=text value="" id=2 size="5"></td>
								<td><input type=text value="" id=3 size="5"></td>
								<td><input type=text value="" id=4 size="5"></td>
								<td><p>圓編號</p></td>
								<td><p>d[u]</p></td>
								<td><p>pi[u]</p></td>
								<td><p>佇列目前狀況:</p></td>
								<td><input type=text value="" id=queue size="15" readonly="readonly"></td>
							</tr>
							<tr>
								<td><p>1</p></td>
								<td><input type=text value="" id=5 size="5"></td>
								<td><input type=text value="0" id=6 size="5" readonly="readonly"></td>
								<td><input type=text value="" id=7 size="5"></td>
								<td><input type=text value="" id=8 size="5"></td>
								<td><input type=text value="" id=9 size="5"></td>
								<td><p>0</p></td>
								<td><input type=text value="" id=0circledu size="5" readonly="readonly"></td>
								<td><input type=text value="" id=0circlepiu size="5" readonly="readonly"></td>
							</tr>
							<tr>
								<td><p>2</p></td>
								<td><input type=text value="" id=10 size="5"></td>
								<td><input type=text value="" id=11 size="5"></td>
								<td><input type=text value="0" id=12 size="5" readonly="readonly"></td>
								<td><input type=text value="" id=13 size="5"></td>
								<td><input type=text value="" id=14 size="5"></td>
								<td><p>1</p></td>
								<td><input type=text value="" id=1circledu size="5" readonly="readonly"></td>
								<td><input type=text value="" id=1circlepiu size="5" readonly="readonly"></td>
							</tr>
							<tr>
								<td><p>3</p></td>
								<td><input type=text value="" id=15 size="5"></td>
								<td><input type=text value="" id=16 size="5"></td>
								<td><input type=text value="" id=17 size="5"></td>
								<td><input type=text value="0" id=18 size="5" readonly="readonly"></td>
								<td><input type=text value="" id=19 size="5"></td>
								<td><p>2</p></td>
								<td><input type=text value="" id=2circledu size="5" readonly="readonly"></td>
								<td><input type=text value="" id=2circlepiu size="5" readonly="readonly"></td>
							</tr>
							<tr>
								<td><p>4</p></td>
								<td><input type=text value="" id=20 size="5"></td>
								<td><input type=text value="" id=21 size="5"></td>
								<td><input type=text value="" id=22 size="5"></td>
								<td><input type=text value="" id=23 size="5"></td>
								<td><input type=text value="0" id=24 size="5" readonly="readonly"></td>
								<td><p>3</p></td>
								<td><input type=text value="" id=3circledu size="5" readonly="readonly"></td>
								<td><input type=text value="" id=3circlepiu size="5" readonly="readonly"></td>
							</tr>
							<tr>
								<td><p></p></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td><p>4</p></td>
								<td><input type=text value="" id=4circledu size="5" readonly="readonly"></td>
								<td><input type=text value="" id=4circlepiu size="5" readonly="readonly"></td>
							</tr>
						</table>
						<table>
							<tr>
								<td><input type = "button"  value = "輸入完成" onClick = "decideAdjMatrix();"></td> 
								<td><input type = "button"  value = "隨機產生" onClick = "randomGenerateAdjMatrix();"></td>
								<td><input type = "button"  value = "清除" onClick = "clearAdjMatrix();"></td> 
							</tr>
						</table>
						<table>
							<tr>
								<td><p id="state"></p></td>
							</tr>
							
						</table>
						<table>
							<tr>
								<td><p>4.現在步驟：</p><textarea name="Content" style="width:550px;height:100px;" id=currentStepBFS readonly="readonly"></textarea></td>
							</tr>
						</table>
						<table>
							<tr>
								<td><input type = "button"  value = "下一步" onClick = "next();"></td> 
								<td><input type = "button"  value = "一次做完" onClick = "doAll();"></td>
								<td><input type = "button"  value = "全部清除" onClick = "clearAll();"></td> 
							</tr>
						</table>
					</form>
				</td>

				<td>

				</td>
			</tr>
		</table>
		

		<script>
			var mode = -1; // 0 is simulate mode  , 1 is test mode
			var graph = -1; // 0 is undirected graph , 1 is directed graph
			var BFSstep = 0; // control the BFS step for the next button use.
			var wrongInput = 0;
			var adjMatrix = []; // A two dimision array adjMatrix represent the graph.
			adjMatrix[0] = [0,0,0,0,0];
			adjMatrix[1] = [0,0,0,0,0];
			adjMatrix[2] = [0,0,0,0,0];
			adjMatrix[3] = [0,0,0,0,0];
			adjMatrix[4] = [0,0,0,0,0];

			var circleDiscover = new Array(0,0,0,0,0); // record the circle wether is discovered.
			var circledu = new Array(-1,-1,-1,-1,-1); // record the circle d[u].
			var circlepiu = new Array(-1,-1,-1,-1,-1); // record the circle pi[u].

			var du = 0;

			var connectString = "";
			var queueString = "";
			var queueStringHandle;
			var string0 = "將所有頂點的d[u]都設為infinity，pi[u]都設為-1(NIL)";
			var string1 = "現在頂點為";
			var string2 = "佇列(Queue)是否為空呢?";
			var string3 = "從佇列拿出最前頭的數為頂點";
			var string4 = "現在和頂點";
			var string5 = "連接的所有還未發現的頂點放入佇列";
			var string6 = "頂點";
			var string7 = "用紅色框框起來，並且它的d[u] = ";
			var string8 = " 然後pi[u] = ";
			var string9 = ",最後放入佇列 ";
			var string10 = "頂點 ";
			var string11 = "已經搜尋完畢，塗黑。";
			var string12 = "Dequeue 1個頂點為";
			
			function modeChoice(){
				var form = document.getElementById("BFSForm");
				var result = document.getElementById("mode");
				clearAdjMatrix();
			
				for (var i = 0; i < form.modeChoice1.length; i++) {
					if ( form.modeChoice1[i].checked ) {
						result.innerHTML = "you selected " + form.modeChoice1[i].value;
						mode = i;
						break;
					}
				}
			}
			
			function graphChoice(){
				var form = document.getElementById("BFSForm");
				var result = document.getElementById("graph");
				clearAdjMatrix();
				
				for (var i = 0; i < form.graph1.length; i++) {
					if ( form.graph1[i].checked ) {
						graph = i;
						result.innerHTML = form.graph1[i].value;
						break;
					}
				}
			}
			
			function modeClear(){
				var form = document.getElementById("BFSForm");
				var result = document.getElementById("mode");
				for (var i = 0; i < form.modeChoice1.length; i++) {
					form.modeChoice1[i].checked = false;
				}
				result.innerHTML = "";
				mode = -1;
			}
			
			function graphClear(){
				var form = document.getElementById("BFSForm");
				var result = document.getElementById("graph");
				for (var i = 0; i < form.graph1.length; i++) {
					form.graph1[i].checked = false;
				}
				result.innerHTML = "";
				graph = -1;
			}

			function decideAdjMatrix(){
				clearGraph();
				var count = 0;
				wrongInput = 0;
				document.getElementById("state").innerHTML = "";
				if(mode == 0 || mode == 1){ // simulate and test
					if(graph == 0){ // undirected graph
						for(var i = 0; i < 3; i++){
							for(var j = 0; j < adjMatrix[i].length; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									var input = document.getElementById(count);
									var userInput = eval(input.value);
									if(userInput != 0 && userInput != 1){
										wrongInput = 1;
									}
									adjMatrix[i][j] = userInput;
									count = count + 1;
								}
							}
						}

						for(var i = 3; i < 5; i++){
							for(var j = 0; j < adjMatrix[i].length; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									var input = document.getElementById(count);
									var userInput = eval(input.value);
									if(userInput != 0 && userInput != 1){
										wrongInput = 1;
									}
									adjMatrix[i][j] = userInput;
									count = count + 1;
								}
							}
						}

						count = 0;
						for(var i = 0; i < 5; i++){
							for(var j = 0; j < adjMatrix[i].length; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									if(adjMatrix[i][j] != adjMatrix[j][i]){ // undirected graph is a symmetric matrix.
										wrongInput = 1;
									}
									
									count = count + 1;
								}
							}
						}

						if(wrongInput == 1){
							clearAdjMatrix(); // User Input the wrong data.
							document.getElementById("state").innerHTML = "你輸入的資料不正確";
						}else{
							drawGraph();
						}
					}else if(graph == 1){
						for(var i = 0; i < 5; i++){
							for(var j = 0; j < adjMatrix[i].length; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									var input = document.getElementById(count);
									var userInput = eval(input.value);
									if(userInput != 0 && userInput != 1){
										wrongInput = 1;
									}
									adjMatrix[i][j] = userInput;
									count = count + 1;
								}
							}
						}
						if(wrongInput == 1){
							clearAdjMatrix(); // User Input the wrong data.
							document.getElementById("state").innerHTML = "你輸入的資料不正確";
						}else{
							drawGraph();
						}
					}else{

					}
				}else{

				}
			}

			function randomGenerateAdjMatrix(){
				clearGraph();
				var count = 0;
				document.getElementById("state").innerHTML = "";
				if(mode == 0 || mode == 1){ // simulate and test
					if(graph == 0){ // undirected graph
						for(var i = 0; i < 5; i++){
							for(var j = i; j < 5; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									var n1 = Math.floor(Math.random()*2);
									var input = document.getElementById(count);
									input.value = n1;
									adjMatrix[i][j] = n1;
									count = count + 1;
								}
							}
							count = count + i + 1;
						}

						count = 5;
						for(var i = 1; i < 5; i++){
							for(var j = 0; j < i; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									var input = document.getElementById(count);
									input.value = adjMatrix[j][i];
									adjMatrix[i][j] = adjMatrix[j][i];
									count = count + 1;
								}
							}
							count = count + (5 - i);
						}
					}else if(graph == 1){
						for(var i = 0; i < 5; i++){
							for(var j = 0; j < adjMatrix[i].length; j++){
								if(i == j){
									count = count + 1;
									continue; // for adj Matrix when i == j must 0
								}else{
									var n1 = Math.floor(Math.random()*2);
									var input = document.getElementById(count);
									input.value = n1;
									adjMatrix[i][j] = n1;
									count = count + 1;
								}
							}
						}
					}else{

					}
					drawGraph();
				}else{

				}
			}// end function randomGenerateAdjMatrix()

			function clearAdjMatrix(){
				
				
				var count = 0;
				for(var i = 0; i < 5; i++){
					for(var j = 0; j < adjMatrix[i].length; j++){
						if(i == j){
							count = count + 1;
							continue; // for adj Matrix when i == j must 0
						}else{
							
							var input = document.getElementById(count);
							input.value = "";
							adjMatrix[i][j] = 0;
							count = count + 1;
						}
					}
				}
				document.getElementById("0").value = 0;
				document.getElementById("6").value = 0;
				document.getElementById("12").value = 0;
				document.getElementById("18").value = 0;
				document.getElementById("24").value = 0;
				

				clearGraph();


			}

			function drawGraph(){
				var canvas = document.getElementById("myGraph");
				var ctx = canvas.getContext("2d");

				if(circleDiscover[0] == 0){
					ctx.beginPath();
					ctx.arc(60,40,30,0,2 * 3.14); // the 0 circle
					ctx.stroke();
				}else if(circleDiscover[0] == 1){
					ctx.beginPath();
					ctx.arc(60,40,30,0,2 * 3.14); // the 0 circle
					ctx.strokeStyle = "red";
					ctx.stroke();
					ctx.strokeStyle = "black";
				}else if(circleDiscover[0] == 2){
					ctx.beginPath();
					ctx.arc(60,40,30,0,2 * 3.14); // the 0 circle
					ctx.fillStyle = "black";
					ctx.fill();
				}else{

				}

				if(circleDiscover[1] == 0){
					ctx.beginPath();
					ctx.arc(220,40,30,0,2 * 3.14); // the 1 circle
					ctx.stroke();
				}else if(circleDiscover[1] == 1){
					ctx.beginPath();
					ctx.arc(220,40,30,0,2 * 3.14); // the 1 circle
					ctx.strokeStyle = "red";
					ctx.stroke();
					ctx.strokeStyle = "black";
				}else if(circleDiscover[1] == 2){
					ctx.beginPath();
					ctx.arc(220,40,30,0,2 * 3.14); // the 1 circle
					ctx.fillStyle = "black";
					ctx.fill();
				}else{
					
				}

				if(circleDiscover[2] == 0){
					ctx.beginPath();
					ctx.arc(60,150,30,0,2 * 3.14); // the 2 circle
					ctx.stroke();
				}else if(circleDiscover[2] == 1){
					ctx.beginPath();
					ctx.arc(60,150,30,0,2 * 3.14); // the 2 circle
					ctx.strokeStyle = "red";
					ctx.stroke();
					ctx.strokeStyle = "black";
				}else if(circleDiscover[2] == 2){
					ctx.beginPath();
					ctx.arc(60,150,30,0,2 * 3.14); // the 2 circle
					ctx.fillStyle = "black";
					ctx.fill();
				}else{
					
				}

				if(circleDiscover[3] == 0){
					ctx.beginPath();
					ctx.arc(220,150,30,0,2 * 3.14); // the 3 circle
					ctx.stroke();
				}else if(circleDiscover[3] == 1){
					ctx.beginPath();
					ctx.arc(220,150,30,0,2 * 3.14); // the 3 circle
					ctx.strokeStyle = "red";
					ctx.stroke();
					ctx.strokeStyle = "black";
				}else if(circleDiscover[3] == 2){
					ctx.beginPath();
					ctx.arc(220,150,30,0,2 * 3.14); // the 3 circle
					ctx.fillStyle = "black";
					ctx.fill();
				}else{
					
				}

				if(circleDiscover[4] == 0){
					ctx.beginPath();
					ctx.arc(140,240,30,0,2 * 3.14); // the 4 circle
					ctx.stroke();
				}else if(circleDiscover[4] == 1){
					ctx.beginPath();
					ctx.arc(140,240,30,0,2 * 3.14); // the 4 circle
					ctx.strokeStyle = "red";
					ctx.stroke();
					ctx.strokeStyle = "black";
				}else if(circleDiscover[4] == 2){
					ctx.beginPath();
					ctx.arc(140,240,30,0,2 * 3.14); // the 4 circle
					ctx.fillStyle = "black";
					ctx.fill();
				}else{
					
				}



				
				ctx.fillText("0",20,20); // write the circle number.
				ctx.fillText("1",260,20);
				ctx.fillText("2",20,130);
				ctx.fillText("3",260,130);
				ctx.fillText("4",180,260);

				if(graph == 0){
					if(adjMatrix[0][1] == 1){ // circle 0 to 1
						ctx.beginPath();
						ctx.moveTo(90,40);
						ctx.lineTo(190,40);
						ctx.stroke();
					}

					if(adjMatrix[0][2] == 1){ // circle 0 to 2
						ctx.beginPath();
						ctx.moveTo(60,70);
						ctx.lineTo(60,120);
						ctx.stroke();
					}

					if(adjMatrix[0][3] == 1){ // circle 0 to 3
						ctx.beginPath();
						ctx.moveTo(80,60);
						ctx.lineTo(198,132);
						ctx.stroke();
					}

					if(adjMatrix[0][4] == 1){ // circle 0 to 4
						ctx.beginPath();
						ctx.moveTo(80,60);
						ctx.lineTo(140,210);
						ctx.stroke();
					}


					if(adjMatrix[1][2] == 1){ // circle 1 to 2
						ctx.beginPath();
						ctx.moveTo(205,63);
						ctx.lineTo(87,135);
						ctx.stroke();
					}

					if(adjMatrix[1][3] == 1){ // circle 1 to 3
						ctx.beginPath();
						ctx.moveTo(220,70);
						ctx.lineTo(220,120);
						ctx.stroke();
					}

					if(adjMatrix[1][4] == 1){ // circle 1 to 4
						ctx.beginPath();
						ctx.moveTo(205,63);
						ctx.lineTo(140,210);
						ctx.stroke();
					}

					if(adjMatrix[2][3] == 1){ // circle 2 to 3
						ctx.beginPath();
						ctx.moveTo(90,150);
						ctx.lineTo(190,150);
						ctx.stroke();
					}

					if(adjMatrix[2][4] == 1){ // circle 2 to 4
						ctx.beginPath();
						ctx.moveTo(80,170);
						ctx.lineTo(140,210);
						ctx.stroke();
					}

					if(adjMatrix[3][4] == 1){ // circle 3 to 4
						ctx.beginPath();
						ctx.moveTo(205,175);
						ctx.lineTo(158,215);
						ctx.stroke();
					}



					
				}else{

				}

			}

			function clearGraph(){
				var canvas = document.getElementById("myGraph");
				var ctx = canvas.getContext("2d");
				ctx.clearRect(0,0,canvas.width,canvas.height);
			}

			function next(){
				if(mode == 0){ // simulate and test
					if(graph == 0){ // undirected graph
						if(BFSstep == 0){
							document.getElementById("0circledu").value = "infinity";
							document.getElementById("0circlepiu").value = "-1";
							document.getElementById("1circledu").value = "infinity";
							document.getElementById("1circlepiu").value = "-1";
							document.getElementById("2circledu").value = "infinity";
							document.getElementById("2circlepiu").value = "-1";
							document.getElementById("3circledu").value = "infinity";
							document.getElementById("3circlepiu").value = "-1";
							document.getElementById("4circledu").value = "infinity";
							document.getElementById("4circlepiu").value = "-1";
							document.getElementById("currentStepBFS").innerHTML = string0;
							BFSstep = 1;

						}else if(BFSstep == 1){
							document.getElementById("currentStepBFS").innerHTML = "現在開始進行BFS\n首先，從頂點0開始，將它用紅框框起來，並d[0]設為0，pi[0]設為-1(NIL)";
							document.getElementById("0circledu").value = "0";
							circleDiscover[0] = 1;
							circledu[0] = 0;
							circlepiu[0] = -1;
							clearGraph();
							drawGraph();
							BFSstep = 2;
						}else if(BFSstep == 2){
							document.getElementById("currentStepBFS").innerHTML = "將頂點0放入佇列";
							queueString = queueString + "0,";
							document.getElementById("queue").value = queueString;
							BFSstep = 3;
						}else if(BFSstep == 3){
							document.getElementById("currentStepBFS").innerHTML = string2;
							queueStringHandle = (document.getElementById("queue").value).split(",");
							if(queueStringHandle[0] == "0"){
								BFSstep = 4;
							}else if(queueStringHandle[0] == "1"){
								BFSstep = 4;
							}else if(queueStringHandle[0] == "2"){
								BFSstep = 4;
							}else if(queueStringHandle[0] == "3"){
								BFSstep = 4;
							}else if(queueStringHandle[0] == "4"){
								BFSstep = 4;
							}else{
								BFSstep = 7;
							}
							
						}else if(BFSstep == 4){
							document.getElementById("currentStepBFS").innerHTML = "不為空\n" + string3 + queueStringHandle[0];
							BFSstep = 5;
						}else if(BFSstep == 5){
							var findcircle = eval(queueStringHandle[0]);
							connectString = string4 + queueStringHandle[0] + string5;
							
							for(var find = 0; find < adjMatrix[findcircle].length; find++){
								if(findcircle == find){
									continue;
								}else{
									if(adjMatrix[findcircle][find] == 1){
										if(circledu[find] == -1){

											var lastDuString = findcircle + "circledu";
											var lastDu = eval(document.getElementById(lastDuString).value);
											lastDu = lastDu + 1;

											connectString = connectString + "\n" + string6 + findcircle + "與" + string6 + find + "有連接 " + string7 + lastDu + string8 + findcircle;
											circleDiscover[find] = 1;


											circledu[find] = lastDu;
											var duString = find + "circledu";
											document.getElementById(duString).value = lastDu;
										
											circlepiu[find] = findcircle;
											var piuString = find + "circlepiu";
											document.getElementById(piuString).value = findcircle;

											connectString = connectString + string9;
											
											queueString = queueString + find + ",";
											
											
										}
										
									}else{

									}
								}
							}
							clearGraph();
							drawGraph();
							document.getElementById("queue").value = queueString;
							document.getElementById("currentStepBFS").innerHTML = connectString;
							connectString = "";
							BFSstep = 6;
						}else if(BFSstep == 6){
							document.getElementById("currentStepBFS").innerHTML = string12 + queueStringHandle[0] + string11;
							var findcircle = eval(queueStringHandle[0]);
							circleDiscover[findcircle] = 2;
							connectQueueString();
							document.getElementById("queue").value = queueString;
							clearGraph();
							drawGraph();
							BFSstep = 3;
						}else{
							document.getElementById("currentStepBFS").innerHTML = "現在佇列為空，結束BFS";
						}
					}
				}
			}

			function connectQueueString(){
				queueStringHandle = queueString.split(",");
				queueString = "";
				for(var i = 1; i < queueStringHandle.length; i++){
					if(queueStringHandle[i] == "0" || queueStringHandle[i] == "1" || queueStringHandle[i] == "2" || queueStringHandle[i] == "3" || queueStringHandle[i] == "4"){
						if(i == (queueStringHandle.length - 1)){
							queueString = queueString + queueStringHandle[i];
						}
						queueString = queueString + queueStringHandle[i] + ",";
					}else{

					}
				}
			}


			function clearAll(){
				document.getElementById("0circledu").value = "";
				document.getElementById("0circlepiu").value = "";
				document.getElementById("1circledu").value = "";
				document.getElementById("1circlepiu").value = "";
				document.getElementById("2circledu").value = "";
				document.getElementById("2circlepiu").value = "";
				document.getElementById("3circledu").value = "";
				document.getElementById("3circlepiu").value = "";
				document.getElementById("4circledu").value = "";
				document.getElementById("4circlepiu").value = "";
				document.getElementById("currentStepBFS").innerHTML = "";
				document.getElementById("queue").value = "";
				BFSstep = 0;
				mode = -1;
				graph = -1;
				clearAdjMatrix();
				wrongInput = 0;
				for(var k = 0; k < circleDiscover.length; k++){
					circleDiscover[k] = 0;
					circledu[k] = -1;
					circlepiu[k] = -1;
				}
				modeClear();
				graphClear();
				connectString = "";
				queueString = "";
			}

		</script>

	</body>
